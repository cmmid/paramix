<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introductory Usage: `paramix` • paramix</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introductory Usage: `paramix`">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">paramix</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/intro.html">Introductory Usage: `paramix`</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introductory Usage: `paramix`</h1>
            
      

      <div class="d-none name"><code>intro.Rmd</code></div>
    </div>

    
    
<p>The <code>paramix</code> package provides translation of parameters
for use in compartmental models. Imagine you have compartments
discretising some feature – for example, converting ages into age
categories – but a process thats depends on that feature – for example,
infection fatality ratio. How do you get the right aggregate parameter
for each of the compartments? And once you get outcomes for your
stratified compartments, is there anyway to impute their
higher-resolution distribution?</p>
<p>With <code>paramix</code>, you can <code><a href="../reference/blend.html">blend()</a></code> a parameter
function into the correctly averaged values, and <code><a href="../reference/distill.html">distill()</a></code>
outcomes to finer resolutions. These functions work via a mapping object
created with <code><a href="../reference/alembic.html">alembic()</a></code>.</p>
<p>In this vignette, we demonstrate applying these functions from an
initial functional relationship through a final analytic process. To
call attention to the where the package fits in, we prepend
<code>paramix::</code>; this is not required during actual use.</p>
<div class="section level3">
<h3 id="motivating-example">Motivating Example<a class="anchor" aria-label="anchor" href="#motivating-example"></a>
</h3>
<p>The SARS-COV-2 pathogen causes COVID-19, which has a distinctly
age-specific mortality. In a meta-analysis, Levin et al<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;a href="https://doi.org/10.1007/s10654-020-00698-1" class="external-link"&gt;Assessing the age
specificity of infection fatality rates for COVID-19: systematic review,
meta-analysis, and public policy implications&lt;/a&gt;&lt;/p&gt;'><sup>1</sup></a> estimated the
age-specific infection-fatality ratio (IFR) for COVID-19 as:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ifr_levin</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">age_in_years</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="op">(</span><span class="fl">10</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="fl">3.27</span> <span class="op">+</span> <span class="fl">0.0524</span> <span class="op">*</span> <span class="va">age_in_years</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-2-1.png" width="100%"></p>
<p>To evaluate the threat of an infectious disease, researchers often
calculate expected “years life lost” (YLLs). Based on age-specific
mortality data, we can estimate how many years individuals at various
ages can expect to live. People who die of a modelled illness lose a
corresponding number of years of life, depending on their age at
death.</p>
<p>In this vignette, we will turn a continuous IFR relationship into
compartmental aggregate IFR and deaths for broader age groups, back to
age-specific deaths, and use these to estimate YLLs.</p>
</div>
<div class="section level3">
<h3 id="parametrizing-a-compartmental-model">Parametrizing a Compartmental Model<a class="anchor" aria-label="anchor" href="#parametrizing-a-compartmental-model"></a>
</h3>
<p>Typically, ODE compartmental models have low-resolution
stratification combining several ages for a mix of computational
reasons, data-availability on other interactions like contact patterns,
and to match intervention targets (e.g. vaccinating children versus
working age adults versus retirees).</p>
<p>When mixing several ages into a single compartment, what is the
properly aggregated value of parameters like the IFR? Generally,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mo>≠</mo><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>E</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>x</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">E\left[f\left(x\right)\right] \ne f\left(E\left[x\right]\right)</annotation></semantics></math>,
so using the IFR at the mean age for the compartment is not guaranteed
to be correct. The average IFR over the age range is more reasonable,
but that assumes a uniform distribution of individuals by age, which is
not generally true. The proper average of IFR needs to be weighted by
the age distribution, or:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">IFR</mtext><msubsup><mo minsize="1.8" maxsize="1.8" stretchy="false" form="postfix">|</mo><mi>a</mi><mi>b</mi></msubsup><mo>=</mo><mfrac><mrow><msubsup><mo>∫</mo><mi>a</mi><mi>b</mi></msubsup><mtext mathvariant="normal">IFR</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">age</mtext><mo stretchy="true" form="postfix">)</mo></mrow><mi>ρ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">age</mtext><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mtext mathvariant="normal">age</mtext></mrow><mrow><msubsup><mo>∫</mo><mi>a</mi><mi>b</mi></msubsup><mi>ρ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">age</mtext><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mtext mathvariant="normal">age</mtext></mrow></mfrac></mrow><annotation encoding="application/x-tex">
\textrm{IFR}\Big\rvert_a^b = \frac{\int_a^b \textrm{IFR}(\textrm{age})\rho(\textrm{age})d\textrm{age}}{\int_a^b \rho(\textrm{age})d\textrm{age}}
</annotation></semantics></math></p>
<p>We can compare the various calculations of the IFR for two different
population age distributions: Afghanistan and the United Kingdom.
Recall, we have considered using:</p>
<ul>
<li>the average age in the function,
i.e. <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">IFR</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><mi>a</mi><mo>+</mo><mi>b</mi></mrow><mn>2</mn></mfrac><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\textrm{IFR}(\frac{a+b}{2})</annotation></semantics></math>
</li>
<li>the function average, assuming uniform age distribution,
i.e. <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>∫</mo><mi>a</mi><mi>b</mi></msubsup><mtext mathvariant="normal">IFR</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">age</mtext><mo stretchy="true" form="postfix">)</mo></mrow><mi>d</mi><mtext mathvariant="normal">age</mtext></mrow><annotation encoding="application/x-tex">\int_a^b \textrm{IFR}(\textrm{age}) d\textrm{age}</annotation></semantics></math>
</li>
<li>the weighted function average (as above)</li>
</ul>
<p>Let’s imagine a compartmental model with age groups [0,5), [5,20),
[20,65), and [65,101], corresponding roughly to pre-school age children,
school age individuals, prime working age adults, and post-working age
adults. First, we need to get the relevant values:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># our model age group cut points</span></span>
<span><span class="va">model_agelimits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">20</span>, <span class="fl">65</span>, <span class="fl">101</span><span class="op">)</span></span>
<span><span class="co"># get select data from World Population Prospects estimates</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"popF"</span>, package <span class="op">=</span> <span class="st">"wpp2019"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"popM"</span>, package <span class="op">=</span> <span class="st">"wpp2019"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pop_dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">popF</span><span class="op">)</span><span class="op">[</span>,</span>
<span>  <span class="fu">.</span><span class="op">(</span><span class="va">name</span>, <span class="va">age</span>, popF <span class="op">=</span> <span class="va">`2020`</span><span class="op">)</span></span>
<span><span class="op">]</span><span class="op">[</span></span>
<span>  <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">popM</span><span class="op">)</span>, on <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"age"</span><span class="op">)</span>,</span>
<span>  <span class="fu">.</span><span class="op">(</span><span class="va">name</span>, <span class="va">age</span>, <span class="va">popF</span>, popM <span class="op">=</span> <span class="va">`2020`</span><span class="op">)</span></span>
<span><span class="op">]</span><span class="op">[</span>, <span class="va">age</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"^(\\d+)[-+].*$"</span>,<span class="st">"\\1"</span>, <span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op">]</span><span class="op">[</span></span>
<span>  <span class="va">name</span> <span class="op"><a href="https://rdatatable.gitlab.io/data.table/reference/like.html" class="external-link">%like%</a></span> <span class="st">"Afghanistan|United Kingdom"</span></span>
<span><span class="op">]</span></span>
<span></span>
<span><span class="va">density_dt</span> <span class="op">&lt;-</span> <span class="va">pop_dt</span><span class="op">[</span>,</span>
<span>  <span class="fu">.</span><span class="op">(</span></span>
<span>    <span class="va">name</span>, from <span class="op">=</span> <span class="va">age</span>,</span>
<span>    weight <span class="op">=</span> <span class="va">popF</span> <span class="op">+</span> <span class="va">popM</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">popF</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">popM</span><span class="op">)</span></span></code></pre></div>
<p>We can calculate the IFR values for each model age group, under
different approaches to computing them. We’ll use the package function
<code><a href="../reference/parameter_summary.html">parameter_summary()</a></code>, which provides a convenient comparison
of the parameter values for these approaches to summarisation:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_dt</span> <span class="op">&lt;-</span> <span class="va">density_dt</span><span class="op">[</span>, <span class="op">{</span> <span class="co"># compute parameters for each country of interest</span></span>
<span>  <span class="fu">paramix</span><span class="fu">::</span><span class="fu"><a href="../reference/parameter_summary.html">parameter_summary</a></span><span class="op">(</span></span>
<span>    f_param <span class="op">=</span> <span class="va">ifr_levin</span>, f_dense <span class="op">=</span> <span class="va">.SD</span>, <span class="va">model_agelimits</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span>, by <span class="op">=</span> <span class="va">name</span><span class="op">]</span></span></code></pre></div>
<p>And plotting these different blends:</p>
<p><img src="intro_files/figure-html/ifrfig-1.png" width="100%"></p>
<p>Clearly, these different approaches result in different mortality
outcomes for otherwise identical infection patterns.</p>
</div>
<div class="section level3">
<h3 id="typical-application">Typical Application<a class="anchor" aria-label="anchor" href="#typical-application"></a>
</h3>
<p>In the previous section, we used a convenience method the package
provides for plotting. More typically, you will want to use the three
main functions in the package:</p>
<ul>
<li>
<code><a href="../reference/alembic.html">alembic()</a></code> to make a weighted mapping from one
resolution to another</li>
<li>
<code><a href="../reference/blend.html">blend()</a></code> to aggregate the associated weighted mixture
parameters</li>
<li>
<code><a href="../reference/distill.html">distill()</a></code> to impute finer scale outcomes from model
outputs</li>
</ul>
<p>Revisiting our previous example, the properly age-weighted IFRs look
like:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># setup the model to outcome mapping using `alembic`s</span></span>
<span><span class="va">mapping_dt</span> <span class="op">&lt;-</span> <span class="va">density_dt</span><span class="op">[</span>,</span>
<span>  <span class="fu">paramix</span><span class="fu">::</span><span class="fu"><a href="../reference/alembic.html">alembic</a></span><span class="op">(</span></span>
<span>    f_param <span class="op">=</span> <span class="va">ifr_levin</span>, f_dense <span class="op">=</span> <span class="va">.SD</span>,</span>
<span>    model_partition <span class="op">=</span> <span class="va">model_agelimits</span>,</span>
<span>    output_partition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">from</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">from</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1L</span>, by <span class="op">=</span> <span class="fl">5L</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  by <span class="op">=</span> <span class="va">name</span></span>
<span><span class="op">]</span></span>
<span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="va">mapping_dt</span><span class="op">[</span>, <span class="fu">paramix</span><span class="fu">::</span><span class="fu"><a href="../reference/blend.html">blend</a></span><span class="op">(</span><span class="va">.SD</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">name</span><span class="op">]</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">model_from</th>
<th align="right">Afghanistan</th>
<th align="right">United Kingdom</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">0.0000074</td>
<td align="right">0.0000074</td>
</tr>
<tr class="even">
<td align="right">5</td>
<td align="right">0.0000269</td>
<td align="right">0.0000271</td>
</tr>
<tr class="odd">
<td align="right">20</td>
<td align="right">0.0011908</td>
<td align="right">0.0024191</td>
</tr>
<tr class="even">
<td align="right">65</td>
<td align="right">0.0444615</td>
<td align="right">0.0820226</td>
</tr>
</tbody>
</table>
<p>These parameters are now weighted correctly for use in a model with
those age groups and underlying populations. Once you run that model,
you might want to disaggregate an outcome, such as for example
converting deaths into years of life lost.</p>
<p>In this example, since the IFR increases with age, deaths occurring
in a wide age group are more likely to have occurred at the older end of
the age group. We can compare a few approaches for calculating the
distribution of deaths: we could assume that deaths occur</p>
<ul>
<li>all at the middle age in the age group,</li>
<li>uniformly within the age group,</li>
<li>proportional to age distribution within the group,</li>
<li>proportional to age <em>and</em> relative mortality rates.</li>
</ul>
<p>For the last option, we can use Bayes’ theorem to calculate about the
correct proportionality:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">P</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">Age</mtext><mo stretchy="false" form="postfix">|</mo><mtext mathvariant="normal">Death</mtext><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><mtext mathvariant="normal">P</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">Death</mtext><mo stretchy="false" form="postfix">|</mo><mtext mathvariant="normal">Age</mtext><mo stretchy="true" form="postfix">)</mo></mrow><mtext mathvariant="normal">P</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">Age</mtext><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mtext mathvariant="normal">P</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">Death</mtext><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac></mrow><annotation encoding="application/x-tex">
\textrm{P}\left(\textrm{Age} \vert \textrm{Death}\right) = \frac{\textrm{P}\left(\textrm{Death} \vert \textrm{Age}\right)\textrm{P}\left(\textrm{Age}\right)}{\textrm{P}\left(\textrm{Death}\right)}
</annotation></semantics></math></p>
<p>We know that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">P</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">Age</mtext><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\textrm{P}\left(\textrm{Age}\right)</annotation></semantics></math>
is the relative fraction of an age within any age group, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><mrow><mtext mathvariant="normal">P</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">Death</mtext><mo stretchy="false" form="postfix">|</mo><mtext mathvariant="normal">Age</mtext><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mtext mathvariant="normal">P</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">Death</mtext><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><annotation encoding="application/x-tex">\frac{\textrm{P}\left(\textrm{Death} \vert \textrm{Age}\right)}{\textrm{P}\left(\textrm{Death}\right)}</annotation></semantics></math>
is the relative mortality rate for that age within that same age group.
We can therefore use those terms to calculate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">P</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="normal">Age</mtext><mo stretchy="false" form="postfix">|</mo><mtext mathvariant="normal">Death</mtext><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\textrm{P}\left(\textrm{Age} \vert \textrm{Death}\right)</annotation></semantics></math>,
and allocate the mortality outcomes accordingly.</p>
<p>For demonstration purposes, let’s assume that one million infections
occur proportionally across the model population groups<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;More typically, the distribution of infections would
reflect other factors such as varying contact patterns. How the
infections are actually distributed would determine the particular
quantitative differences for our demonstration, but not the qualitative
point.&lt;/p&gt;"><sup>2</sup></a>. Using our
properly-weighted IFR values for each age group from above, these
infections result in deaths as follows:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_density_dt</span> <span class="op">&lt;-</span> <span class="va">density_dt</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span></span>
<span>  model_from <span class="op">=</span> <span class="va">model_agelimits</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/findInterval.html" class="external-link">findInterval</a></span><span class="op">(</span><span class="va">from</span>, <span class="va">model_agelimits</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="va">weight</span></span>
<span><span class="op">)</span>, by <span class="op">=</span> <span class="va">name</span><span class="op">]</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">name</span>, <span class="va">model_from</span><span class="op">)</span><span class="op">]</span><span class="op">[</span>,</span>
<span>  <span class="va">weight</span> <span class="op">:=</span> <span class="va">weight</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">name</span></span>
<span><span class="op">]</span></span>
<span><span class="va">model_deaths_dt</span> <span class="op">&lt;-</span> <span class="va">model_density_dt</span><span class="op">[</span></span>
<span>  <span class="va">params</span>, on <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">name</span>, <span class="va">model_from</span><span class="op">)</span></span>
<span><span class="op">]</span><span class="op">[</span>,</span>
<span>  <span class="fu">.</span><span class="op">(</span><span class="va">name</span>, <span class="va">model_from</span>, deaths <span class="op">=</span> <span class="va">weight</span> <span class="op">*</span> <span class="fl">1e6</span> <span class="op">*</span> <span class="va">value</span><span class="op">)</span></span>
<span><span class="op">]</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">Afghanistan</th>
<th align="right">United Kingdom</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">0 - 4</td>
<td align="right">1.074175</td>
<td align="right">0.4261563</td>
</tr>
<tr class="even">
<td align="left">5 - 19</td>
<td align="right">10.516660</td>
<td align="right">4.6989708</td>
</tr>
<tr class="odd">
<td align="left">20 - 64</td>
<td align="right">519.633628</td>
<td align="right">1408.8529634</td>
</tr>
<tr class="even">
<td align="left">65 - 100</td>
<td align="right">1177.814282</td>
<td align="right">15299.9565319</td>
</tr>
</tbody>
</table>
<p>How would these translate into age-specific deaths, based on these
different calculation methods? For convenience, <code>paramix</code> can
compute all approaches mentioned above for comparison:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">distill_methods_dt</span> <span class="op">&lt;-</span> <span class="va">model_deaths_dt</span><span class="op">[</span>,</span>
<span>  <span class="fu">paramix</span><span class="fu">::</span><span class="fu"><a href="../reference/distill_summary.html">distill_summary</a></span><span class="op">(</span></span>
<span>    <span class="va">.SD</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">model_from</span>, value <span class="op">=</span> <span class="va">deaths</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    <span class="va">mapping_dt</span><span class="op">[</span><span class="va">name</span> <span class="op">==</span> <span class="va">.BY</span><span class="op">]</span></span>
<span>  <span class="op">)</span>,</span>
<span>  by <span class="op">=</span> <span class="va">name</span></span>
<span><span class="op">]</span></span></code></pre></div>
<p>You can see the calculations by entering
<code><a href="../reference/distill_summary.html">paramix::distill_summary</a></code> (no parentheses) as an R prompt.
Plotted, the results for the four different methods of calculation look
like:</p>
<p><img src="intro_files/figure-html/alembicplot-1.png" width="100%">
When we combine these different deaths-by-age with life expectancy
estimates, we see these differences in estimated years of life lost.
Without the necessary adjustments for both age structure and mortality
shape, we typically overestimate YLLs.</p>
<pre><code><span><span class="co">#&gt; Warning: Removed 2 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_bar()`).</span></span></code></pre>
<p><img src="intro_files/figure-html/figlex-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>Properly blending and distilling parameter values can make a
relatively large difference when estimating outcomes that are
non-linear, for example years-life-lost. This package can make doing
that correctly relatively easy.</p>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Carl Pearson, Simon Proctor, Lucy Goodfellow.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
