<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create the Blending and Distilling Object — alembic • paramix</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create the Blending and Distilling Object — alembic"><meta name="description" content="Based on model and output partitions, create a mixing partition and
associated weights. That table of mixing values can be used to properly
discretize a continuously varying (or otherwise high resolution) parameter to
a relatively low resolution compartmental stratification, and then
subsequently allocate the low-resolution model outcomes into the most likely
high-resolution output partitions."><meta property="og:description" content="Based on model and output partitions, create a mixing partition and
associated weights. That table of mixing values can be used to properly
discretize a continuously varying (or otherwise high resolution) parameter to
a relatively low resolution compartmental stratification, and then
subsequently allocate the low-resolution model outcomes into the most likely
high-resolution output partitions."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">paramix</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/intro.html">Introductory Usage: `paramix`</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Create the Blending and Distilling Object</h1>

      <div class="d-none name"><code>alembic.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Based on model and output partitions, create a mixing partition and
associated weights. That table of mixing values can be used to properly
discretize a continuously varying (or otherwise high resolution) parameter to
a relatively low resolution compartmental stratification, and then
subsequently allocate the low-resolution model outcomes into the most likely
high-resolution output partitions.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">alembic</span><span class="op">(</span></span>
<span>  <span class="va">f_param</span>,</span>
<span>  <span class="va">f_pop</span>,</span>
<span>  <span class="va">model_partition</span>,</span>
<span>  <span class="va">output_partition</span>,</span>
<span>  pars_interp_opts <span class="op">=</span> <span class="fu"><a href="interpolate_opts.html">interpolate_opts</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/stats/splinefun.html" class="external-link">splinefun</a></span>, kind <span class="op">=</span> <span class="st">"point"</span>, method <span class="op">=</span></span>
<span>    <span class="st">"natural"</span><span class="op">)</span>,</span>
<span>  pop_interp_opts <span class="op">=</span> <span class="fu"><a href="interpolate_opts.html">interpolate_opts</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approxfun</a></span>, kind <span class="op">=</span> <span class="st">"integral"</span>, method <span class="op">=</span></span>
<span>    <span class="st">"constant"</span>, yleft <span class="op">=</span> <span class="fl">0</span>, yright <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-f-param">f_param<a class="anchor" aria-label="anchor" href="#arg-f-param"></a></dt>
<dd><p>a function, <code>f(x)</code> which transforms the feature (e.g. age),
to yield the parameter values. Alternatively, a <code>data.frame</code> where the first
column is the feature and the second is the parameter; see <code><a href="https://rdrr.io/r/grDevices/xy.coords.html" class="external-link">xy.coords()</a></code> for
details. If the latter, combined with <code>pars_interp_opts</code> to create a
parameter function.</p></dd>


<dt id="arg-f-pop">f_pop<a class="anchor" aria-label="anchor" href="#arg-f-pop"></a></dt>
<dd><p>like <code>f_param</code>, either a density function (though it does
not have to integrate to 1 like a pdf) or a <code>data.frame</code> of values. If the
latter, it is treated as a series of populations within intervals, and
then interpolated with <code>pop_interp_opts</code> to create a density function.</p></dd>


<dt id="arg-model-partition">model_partition<a class="anchor" aria-label="anchor" href="#arg-model-partition"></a></dt>
<dd><p>a numeric vector of cut points, which define the
partitioning that will be used in the model; must be length &gt; 1</p></dd>


<dt id="arg-output-partition">output_partition<a class="anchor" aria-label="anchor" href="#arg-output-partition"></a></dt>
<dd><p>the partition of the underlying feature; must be
length &gt; 1</p></dd>


<dt id="arg-pars-interp-opts">pars_interp_opts<a class="anchor" aria-label="anchor" href="#arg-pars-interp-opts"></a></dt>
<dd><p>a list, minimally with an element <code>fun</code>,
corresponding to an interpolation function. Defaults to <code><a href="https://rdrr.io/r/stats/splinefun.html" class="external-link">splinefun()</a></code>
"natural" interpolation.</p></dd>


<dt id="arg-pop-interp-opts">pop_interp_opts<a class="anchor" aria-label="anchor" href="#arg-pop-interp-opts"></a></dt>
<dd><p>like <code>pars_interp_opts</code>, but for density. Defaults to
<code><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approxfun()</a></code> "constant" interpolation.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a <code>data.table</code> with columns: <code>model_partition</code>, <code>output_partition</code>, <code>weight</code> and
<code>relpop</code>. The first two columns identify partition lower bounds, for both the model
and output, the other values are associated with; the combination of
<code>model_partition</code> and <code>output_partition</code> forms a unique identifier, but individually they
may appear multiple times. Generally, this object is only useful as an input
to the <code><a href="blend.html">blend()</a></code> and <code><a href="distill.html">distill()</a></code> tools.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The <code>alembic</code> function creates a mixing table, which governs the conversion
between model and output partitions. The mixing table a
<code><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table::data.table()</a></code> where each row corresponds to a mixing partition
\(c_i\), which is the union of the model and output partitions - i.e. each
unique boundary is included. Within each row, there is a <code>weight</code> and
<code>relpop</code> entry, corresponding to</p>
<p>$$
\textrm{weight}_i = \int_{c_i} f(x)\rho(x)\text{d}x
$$
$$
\textrm{relpop}_i = \int_{c_i} \rho(x)\text{d}x
$$</p>
<p>where \(f(x)\) corresponds to the <code>f_param</code> argument and \(\rho(x)\)
corresponds to the <code>f_pop</code> argument.</p>
<p>This mixing table is used in the <code><a href="blend.html">blend()</a></code> and <code><a href="distill.html">distill()</a></code> functions.</p>
<p>When <code>blend</code>ing, the appropriately weighted parameter for a model partition
is the sum of \(\textrm{weight}_i\) divided by the \(\textrm{relpop}_i\)
associated with mixing partition(s) in that model partition. This corresponds
to the properly, population weighted average of that parameter over the
partition.</p>
<p>When <code>distill</code>ing, model outcomes associated with weighted parameter from
partition \(j\) are distributed to the output partition \(i\) by the sum
of weights in mixing partitions in both \(j\) and \(i\) divided by the
total weight in \(j\). This corresponds to proportional allocation
according to Bayes rule: the outcome in the model partition was relatively
more likely in the higher weight mixing partition.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="blend.html">blend()</a></code></p>
<p><code><a href="distill.html">distill()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">ifr_levin</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">age_in_years</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="op">(</span><span class="fl">10</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="fl">3.27</span> <span class="op">+</span> <span class="fl">0.0524</span> <span class="op">*</span> <span class="va">age_in_years</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">age_limits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">69</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, <span class="fl">70</span>, <span class="fl">80</span>, <span class="fl">101</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">age_pyramid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  from <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">101</span>, weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">101</span> <span class="op">&lt;</span> <span class="fl">65</span>, <span class="fl">1</span>, <span class="fl">.99</span><span class="op">^</span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">101</span><span class="op">-</span><span class="fl">64</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">age_pyramid</span><span class="op">$</span><span class="va">weight</span><span class="op">[</span><span class="fl">102</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span></span>
<span class="r-in"><span><span class="co"># flat age distribution, then 1% annual deaths, no one lives past 101</span></span></span>
<span class="r-in"><span><span class="va">ifr_alembic</span> <span class="op">&lt;-</span> <span class="fu">alembic</span><span class="op">(</span><span class="va">ifr_levin</span>, <span class="va">age_pyramid</span>, <span class="va">age_limits</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">101</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Carl Pearson, Simon Proctor, Lucy Goodfellow.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

